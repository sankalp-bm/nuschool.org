---
layout: default
title: Addition
---

<main class="flex-1 flex flex-col items-center justify-center p-4" x-data="additionExercise()" x-init="generateProblem()" style="min-height: 100vh;">
  <!-- Main content area with background and border -->
  <div style="background: #ffe6e6; border-radius: 2rem; box-shadow: 0 2px 16px #0001; padding: 2.5rem 1.5rem; margin: 2rem 0; display: flex; flex-direction: column; align-items: center; min-width: 340px; max-width: 420px;">
    <!-- Level Controls -->
    <div class="level-controls" style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
      <button class="level-btn" :disabled="level === 1" @click="changeLevel(-1)" style="font-size: 36px; width: 2.5rem; height: 2.5rem; border: 2px solid #F7CAC9; border-radius: 0.5rem; background: transparent; display: flex; align-items: center; justify-content: center;">-</button>
      <div class="level-btn level" style="font-size: 36px; font-weight: bold; background: #e0ffe0; border: 2px solid #F7CAC9; border-radius: 1rem; padding: 0.2rem 1.2rem; min-width: 3.5rem; min-height: 2.5rem; display: flex; align-items: center; justify-content: center;" x-text="'L' + level"></div>
      <button class="level-btn plus" :disabled="level === 14" @click="changeLevel(1)" style="font-size: 36px; width: 2.5rem; height: 2.5rem; border: 2px solid #F7CAC9; border-radius: 0.5rem; background: transparent; display: flex; align-items: center; justify-content: center;">+</button>
    </div>
    <!-- Math Problem Block -->
    <div class="math-block" style="margin-bottom: 1rem;">
      <div style="display: flex; flex-direction: column; align-items: flex-end;">
        <!-- Addends grid -->
        <div style="display: flex; flex-direction: row; align-items: center;">
          <div style="width: 2.5rem;"></div>
          <template x-for="(cell, idx) in addendCells" :key="'a1'+idx">
            <div style="width: 2.5rem; height: 2.5rem; border: 2px solid #F7CAC9; border-radius: 0.5rem; margin: 0 0.1rem; display: flex; align-items: center; justify-content: center; font-size: 36px; background: transparent;" x-text="cell[0]"></div>
          </template>
        </div>
        <div style="display: flex; flex-direction: row; align-items: center; margin-top: 0.2rem;">
          <div style="width: 2.5rem; text-align: center; font-size: 36px; color: #b57b79; font-weight: bold;">+</div>
          <template x-for="(cell, idx) in addendCells" :key="'a2'+idx">
            <div style="width: 2.5rem; height: 2.5rem; border: 2px solid #F7CAC9; border-radius: 0.5rem; margin: 0 0.1rem; display: flex; align-items: center; justify-content: center; font-size: 36px; background: transparent;" x-text="cell[1]"></div>
          </template>
        </div>
        <div :style="'border-bottom: 3px solid #888; width: ' + ((cellCount+1) * 2.7) + 'rem; margin: 0.5rem 0 0.2rem 0;'"></div>
      </div>
    </div>
    <!-- Answer Cells -->
    <div style="display: flex; gap: 0.3rem; margin-bottom: 1.2rem;">
      <template x-for="(cell, idx) in answerCells" :key="idx">
        <input type="text" maxlength="1" class="math-cell answer-cell" :value="cell" readonly
          @click="activeCell = idx"
          style="width: 2.5rem; height: 2.5rem; text-align: center; font-size: 36px; border: 2px solid #F7CAC9; border-radius: 0.5rem; background: transparent; display: flex; align-items: center; justify-content: center;">
      </template>
    </div>
    <!-- Keypad and Buttons -->
    <div class="cheerful-box bg-white rounded-lg shadow-lg w-full max-w-md mt-2" style="background: none; box-shadow: none;">
      <div class="mt-6 flex flex-col items-center">
        <div class="keypad-grid" style="display: grid; grid-template-columns: repeat(4, 2.5rem); gap: 0.3rem;">
          <template x-for="n in [7,8,9]" :key="'k'+n">
            <button class="keypad-btn" @click="pressKey(''+n)" style="font-size:36px; width:2.5rem; height:2.5rem; border:2px solid #F7CAC9; border-radius:0.5rem; background:transparent; display:flex; align-items:center; justify-content:center;" x-text="n"></button>
          </template>
          <button class="cheerful-btn" @click="generateProblem" style="font-size:36px; width:2.5rem; height:2.5rem; border:2px solid #F7CAC9; border-radius:0.5rem; background:transparent; display:flex; align-items:center; justify-content:center;">&#8635;</button>
          <template x-for="n in [4,5,6]" :key="'k2'+n">
            <button class="keypad-btn" @click="pressKey(''+n)" style="font-size:36px; width:2.5rem; height:2.5rem; border:2px solid #F7CAC9; border-radius:0.5rem; background:transparent; display:flex; align-items:center; justify-content:center;" x-text="n"></button>
          </template>
          <button class="cheerful-btn" @click="showHint" style="font-size:36px; width:2.5rem; height:2.5rem; border:2px solid #F7CAC9; border-radius:0.5rem; background:transparent; display:flex; align-items:center; justify-content:center;">?</button>
          <template x-for="n in [1,2,3]" :key="'k3'+n">
            <button class="keypad-btn" @click="pressKey(''+n)" style="font-size:36px; width:2.5rem; height:2.5rem; border:2px solid #F7CAC9; border-radius:0.5rem; background:transparent; display:flex; align-items:center; justify-content:center;" x-text="n"></button>
          </template>
          <button class="cheerful-btn" @click="showRules" style="font-size:36px; width:2.5rem; height:2.5rem; border:2px solid #F7CAC9; border-radius:0.5rem; background:transparent; display:flex; align-items:center; justify-content:center;">&#128214;</button>
          <button class="keypad-btn" @click="pressKey('0')" style="font-size:36px; width:2.5rem; height:2.5rem; border:2px solid #F7CAC9; border-radius:0.5rem; background:transparent; display:flex; align-items:center; justify-content:center;">0</button>
          <button class="keypad-btn" @click="pressKey('.')" style="font-size:36px; width:2.5rem; height:2.5rem; border:2px solid #F7CAC9; border-radius:0.5rem; background:transparent; display:flex; align-items:center; justify-content:center;">.</button>
          <button class="keypad-btn" @click="undoInput()" style="font-size:36px; width:2.5rem; height:2.5rem; border:2px solid #F7CAC9; border-radius:0.5rem; background:transparent; display:flex; align-items:center; justify-content:center;">&#8630;</button>
          <button class="cheerful-btn bg-green-500 hover:bg-green-600 border-none" style="color: #fff !important; background-color: #22c55e !important; font-size:36px; width:2.5rem; height:2.5rem; border:2px solid #F7CAC9; border-radius:0.5rem; display:flex; align-items:center; justify-content:center;" @click="checkAnswer">&#10003;</button>
        </div>
      </div>
    </div>
    <!-- Feedback Popup -->
    <template x-if="showFeedback">
      <div style="position:fixed; top:45%; left:50%; transform:translate(-50%,-50%); background:#fff; border:3px solid #F7CAC9; border-radius:1rem; padding:1rem 2rem; font-size:36px; font-weight:bold; z-index:1000; box-shadow:0 4px 24px #0002;">
        <span x-text="feedback"></span>
      </div>
    </template>
    <!-- Rules Popup -->
    <template x-if="showRulesPopup">
      <div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50" @keydown.escape.window="showRulesPopup=false" tabindex="0">
        <div class="bg-white rounded-lg shadow-lg p-6 w-80 text-center" style="font-size:36px;">
          <div class="text-xl font-bold mb-4">Rules of Addition</div>
          <div class="mb-4 text-left">
            <ul class="list-disc ml-6 text-sm text-gray-700">
              <li>Add numbers from right (ONES) to left (TENS, HUNDREDS, ...).</li>
              <li>If the sum is 10 or more, carry over to the next column.</li>
              <li>Line up the digits by place value.</li>
              <li>Check your answer before submitting!</li>
            </ul>
          </div>
          <button @click="showRulesPopup=false" class="cheerful-btn" style="font-size:36px; border:2px solid #F7CAC9; border-radius:0.5rem;">Close</button>
        </div>
      </div>
    </template>
    <!-- Hint Popup -->
    <template x-if="showHintPopup">
      <div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50" @keydown.escape.window="showHintPopup=false" tabindex="0">
        <div class="bg-white rounded-lg shadow-lg p-6 w-80 text-center" style="font-size:36px;">
          <div class="text-xl font-bold mb-4">Hint</div>
          <div class="mb-4 text-left text-sm text-gray-700">
            Try adding the rightmost digits first. If the sum is 10 or more, write the ONES digit and carry the TENS to the next column!
          </div>
          <button @click="showHintPopup=false" class="cheerful-btn" style="font-size:36px; border:2px solid #F7CAC9; border-radius:0.5rem;">Close</button>
        </div>
      </div>
    </template>
  </div>
</main>

<!-- Alpine.js for reactivity -->
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script>
function additionExercise() {
  return {
    firstNumber: 0,
    secondNumber: 0,
    answerCells: [],
    activeCell: 0,
    feedback: '',
    showFeedback: false,
    level: 3,
    showRulesPopup: false,
    showHintPopup: false,
    cellCount: 3,
    addendCells: [],
    changeLevel(delta) {
      const maxLevel = 14;
      const minLevel = 1;
      this.level = Math.max(minLevel, Math.min(maxLevel, this.level + delta));
      this.generateProblem();
    },
    generateProblem() {
      // For demo: 2-digit numbers, can expand for levels
      this.firstNumber = Math.floor(Math.random() * 90) + 10;
      this.secondNumber = Math.floor(Math.random() * 90) + 10;
      const maxDigits = Math.max(this.firstNumber.toString().length, this.secondNumber.toString().length);
      this.cellCount = maxDigits + 1;
      this.answerCells = Array(this.cellCount).fill('');
      this.activeCell = this.cellCount - 1;
      // Prepare addend cells for display
      const fStr = this.firstNumber.toString().padStart(this.cellCount, ' ');
      const sStr = this.secondNumber.toString().padStart(this.cellCount, ' ');
      this.addendCells = [];
      for (let i = 0; i < this.cellCount; i++) {
        this.addendCells.push([fStr[i] !== ' ' ? fStr[i] : '', sStr[i] !== ' ' ? sStr[i] : '']);
      }
      this.feedback = '';
      this.showFeedback = false;
    },
    pressKey(key) {
      if (this.activeCell === null) return;
      if (key === '.' && this.answerCells.includes('.')) return;
      this.answerCells[this.activeCell] = key;
      if (this.activeCell > 0) {
        this.activeCell--;
      }
    },
    undoInput() {
      if (this.activeCell < this.answerCells.length - 1) {
        this.activeCell++;
        this.answerCells[this.activeCell] = '';
      }
    },
    checkAnswer() {
      const userAnswer = this.answerCells.join('').replace(/\s/g, '');
      const correct = (this.firstNumber + this.secondNumber).toString().padStart(this.answerCells.length, ' ');
      if (userAnswer === correct.replace(/\s/g, '')) {
        this.feedback = '✅ Correct!';
        this.showFeedback = true;
        setTimeout(() => {
          this.showFeedback = false;
          this.generateProblem();
        }, 2000);
      } else {
        this.feedback = '❌ Try again!';
        this.showFeedback = true;
        setTimeout(() => {
          this.showFeedback = false;
        }, 2000);
      }
    },
    showHint() {
      this.showHintPopup = true;
    },
    showRules() {
      this.showRulesPopup = true;
    }
  }
}
</script> 